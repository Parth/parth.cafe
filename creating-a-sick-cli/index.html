<!DOCTYPE html>
<html lang="en" >

<head>
    <meta charset="UTF-8"><meta http-equiv="Content-Security-Policy"
content="default-src 'self';font-src &#x27;self&#x27; data:;img-src &#x27;self&#x27; https:&#x2F;&#x2F;* data:;media-src &#x27;self&#x27;;style-src &#x27;self&#x27;;frame-src player.vimeo.com https:&#x2F;&#x2F;www.youtube-nocookie.com;connect-src 'self';script-src 'self' 'self'">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="base" content="https://parth.github.io/parth.cafe">

    
    <title>
Parth • Creating a SICK CLI</title>

    
    
    

    
    

    
    
    
        
            <link rel="stylesheet" href="https://parth.github.io/parth.cafe/custom_subset.css?h=0b9535a28bc3d5bf2321">
        
    

    
        <link rel="stylesheet" href="https://parth.github.io/parth.cafe/main.css?h=6b1dda977391dad0c76e" />

    <meta name="color-scheme" content="light dark" />
        <meta name="description" content="" />
        <meta property="og:description" content="" />

    

    <meta property="og:title" content="Creating a SICK CLI" />
    <meta property="og:type" content="article" />

    
<meta property="og:locale" content="en_GB" />

    <meta property="og:url" content="https:&#x2F;&#x2F;parth.github.io&#x2F;parth.cafe&#x2F;creating-a-sick-cli&#x2F;" /><meta property="og:site_name" content="Parth">
        <noscript><link rel="stylesheet" href="https://parth.github.io/parth.cafe/no_js.css"/></noscript>
        <script type="text/javascript" src="https://parth.github.io/parth.cafe/js/initializeTheme.min.js"></script>
        <script defer src="https://parth.github.io/parth.cafe/js/themeSwitcher.min.js"></script><script defer src="https://parth.github.io/parth.cafe/search_index.en.js?h=a9d5e49826c88119a540"></script>
        <script defer src="https://parth.github.io/parth.cafe/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e"></script>

        </head>


<body>
    <header>
    <nav class="navbar">
        <div class="nav-title">
            <a class="home-title" href="https://parth.github.io/parth.cafe">Parth</a>
        </div>
            <div class="nav-navs">
                <ul>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://parth.github.io/parth.cafe/blog/">blog
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://parth.github.io/parth.cafe/archive/">archive
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://parth.github.io/parth.cafe/tags/">tags
                                </a>
                            </li>
                        <li class="menu-icons-container">
                        <ul class="menu-icons-group">
                            <li class="js menu-icon">
                                <div role="button" tabindex="0" id="search-button" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" aria-label="Click or press $SHORTCUT to open search">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                                        <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
                                    </svg>
                                </div>
                            </li>

                            
                            

                            <li class="theme-switcher-wrapper js"><div
        title="Toggle dark&#x2F;light mode"
        class="theme-switcher"
        tabindex="0"
        role="button"
        aria-label="Toggle dark mode"
        aria-pressed="false">
    </div><div
        title="Reset mode to default"
        class="theme-resetter arrow"
        tabindex="0"
        role="button"
        aria-hidden="true"
        aria-label="Reset mode to default">
    </div>

</li>
</ul>
                    </li>
                </ul>
            </div>
        
    </nav>
</header>

    <div class="content">

        
        




<main>
    <article>
        <h1 class="article-title">
            Creating a SICK CLI
        </h1>

        <ul class="meta">

            
                <span class="hidden p-author h-card">
<a rel="author" href="https:&#x2F;&#x2F;parth.github.io&#x2F;parth.cafe" class="u-url " title=""></a>
</span>

            
                <li>11th Oct 2023</li><li title="1209 words"><span class='separator' aria-hidden='true'>•</span>7 min read</li><li class="tag"><span class='separator' aria-hidden='true'>•</span>Tags:&nbsp;</li><li class="tag"><a href="https://parth.github.io/parth.cafe/tags/lockbook/">lockbook</a>,&nbsp;</li><li class="tag"><a href="https://parth.github.io/parth.cafe/tags/programming/">programming</a></li>
        </ul>

        <section class="body"><h1 id="creating-a-sick-cli">Creating a SICK CLI</h1>
<p>At <a href="https://parth.cafe/p/introducing-lockbook">Lockbook</a> we strongly believe in <a href="https://en.wikipedia.org/wiki/Eating_your_own_dog_food">dogfooding</a>. So we knew alongside a great, native, markdown editing experience we would want a <em>sick</em> CLI. Having a <em>sick</em> CLI creates interesting opportunities for a niche type of user who is familiar with a terminal environment:</p>
<ul>
<li>They can use the text editor they're deeply familiar with.</li>
<li>They can write scripts against their Lockbook.</li>
<li>They can vastly reduce the surface area of attack.</li>
<li>Can always maintain remote access to their Lockbook via SSH.</li>
</ul>
<p>In this post I’m going to tackle 3 topics:</p>
<ol>
<li>What makes a CLI sick?</li>
<li>How do you go about realizing some of those “interesting opportunities” using our CLI?</li>
<li>What’s next for our CLI?</li>
</ol>
<h1 id="what-makes-a-cli-sick">What makes a CLI <em>sick</em>?</h1>
<p>It’s tab completions. For me, tab completions are what I use to initially explore what a CLI can do. Later, if the CLI is <em>sick</em>, I use tab completions to speed up my workflow. I don’t just want to tab complete the structure of the CLI (subcommands and flags). I want to tab complete dynamic values, in Lockbook's case, this means completing file paths and IDs.</p>
<p>If you're creating a CLI most libraries make you choose between a few bad options:</p>
<ul>
<li>Hand-craft completion files for each shell.</li>
<li>Sacrifice dynamic completions and just settle for automatically generated static completions.</li>
</ul>
<p>Rust is no exception here, <code>clap</code> has some support for static completions, but no way to invoke dynamic completions without writing a completion file for each shell.</p>
<p>And so we set out to solve this problem for the Rust ecosystem, and created <code>cli-rs</code>. A parsing library, similar to <code>clap</code> but with explicit design priorities around creating a great tab completion experience. As soon as <code>cli-rs</code> was stable enough we re-wrote <code>lockbook</code>'s CLI using it so we could pass on these gains to our users.</p>
<p>Cli-rs is simple, you describe your CLI like this:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>Command::name(&quot;lockbook&quot;)
</span><span>    .description(&quot;The private, polished note-taking platform.&quot;) 
</span><span>    .version(env!(&quot;CARGO_PKG_VERSION&quot;))
</span><span>    .subcommand(
</span><span>        Command::name(&quot;delete&quot;)
</span><span>            .description(&quot;delete a file&quot;)
</span><span>            .input(Flag::bool(&quot;force&quot;))
</span><span>            .input(Arg::&lt;FileInput&gt;::name(&quot;target&quot;).description(&quot;path of id of file to delete&quot;)
</span><span>                        .completor(|prompt| input::file_completor(core, prompt, None)))
</span><span>            .handler(|force, target| delete(core, force.get(), target.get()))
</span><span>    )
</span><span>    .subcommand(
</span><span>        Command::name(&quot;edit&quot;)
</span><span>            .description(&quot;edit a document&quot;)
</span><span>            .input(edit::editor_flag())
</span><span>            .input(Arg::&lt;FileInput&gt;::name(&quot;target&quot;).description(&quot;path or id of file to edit&quot;)
</span><span>                        .completor(|prompt| input::file_completor(core, prompt, None)))
</span><span>            .handler(|editor, target| edit::edit(core, editor.get(), target.get()))
</span><span>    )
</span><span>...
</span></code></pre>
<p>This gives the parser all the information it needs to offer the best tab completion behavior. It handles all the static completions internally and then invokes your program when it’s time to dynamically populate a field with your user’s data.</p>
<p>We also invested a ton of effort in the infrastructure that deploys our CLI to our customer's machines so that tab completions would be set up for most people by default.</p>
<h1 id="exciting-opportunities-for-power-users">Exciting Opportunities for Power Users</h1>
<h2 id="use-your-favorite-text-editor">Use your favorite text editor</h2>
<p>You can <code>lockbook edit</code> any path you have access to and our CLI will invoke <code>vim</code>, utilizing any custom <code>.vimrc</code> that may exist. You can override the selected editor by setting the <code>LOCKBOOK_EDITOR</code> env var or using the <code>--editor</code> flag. So far we support <code>vim</code>, <code>nvim</code>, <code>subl</code>, <code>code</code>, <code>emacs</code> and <code>nano</code>.</p>
<p>If we don’t support your favorite editor, send us a PR or hop in our <a href="https://parth.github.io/parth.cafe/creating-a-sick-cli/TODO">discord</a> and tell us.</p>
<h2 id="extending-lockbook">Extending Lockbook</h2>
<p>We want Lockbook to be maximally extensible, this extensibility will take many forms, one of which is our CLI. Let's explore some of the interesting things you can accomplish with our CLI.</p>
<p>Let’s say you wanted a snapshot of everything in your second brain decrypted and without any proprietary format for tin-foil-hat backup reasons. You can easily set a <code>cron</code> that will simply <code>lockbook sync</code> and <code>lockbook backup</code> however often you want. <code>lockbook export</code> can be used to write any folder or document from Lockbook to your file system, paving the way for automated updates of a blog. Edit a note on your phone, and see the change live on your blog in seconds. <code>lockbook import</code> lets you do the opposite. Want to continuously back up a folder from your computer to Lockbook? Setup a <code>cron</code> that will simply <code>Lockbook import</code> and then <code>lockbook sync</code>.</p>
<h2 id="ultra-secure">Ultra secure</h2>
<p>I like to think about security as the product of a few numbers. So if, for example, you’re product is closed source, one of those numbers in your multiplication chain is a big fat zero. And there’s nothing you can do to pretend it’s secure. Similarly, the age of a product is one of those numbers. Newer is worse, and this is one of Lockbook’s current weaknesses.</p>
<p>But one of Lockbook’s strengths is how much you can reduce the total amount of code it takes to interact with Lockbook. On one end of the spectrum, you have software that <strong>requires</strong> a full browser installation to perform the most basic tasks. Slightly better than that is software that runs natively, and on the other end of the spectrum is software that doesn’t even rely on a UI library. Once we’re mature, if you wanted to run Lockbook on a libre-booted thinkpad running an ultra-minimal operating system, Lockbook wouldn’t require you to add the Google Chrome dependency tree to your setup.</p>
<h2 id="remote-lockbook">Remote Lockbook</h2>
<p>Sometimes you find yourself employed by a financial institution that heavily restricts what you can do on their machines. Without thinking too much more about your situation you may want to simply add something to your grocery list without pulling out your phone. Unfortunately, IT has locked down your remote Windows 7 installation, and not only can you not install our Windows app (which does not require administrator privileges to install) but you cannot visit GitHub itself!</p>
<p>Maybe in this environment, it’s not worth it to update your grocery list, but you identify with the likes of Ron Swanson, and you will not be defeated by your IT department. How? Because you port forwarded your desktop and memorized a lengthy SSH password. So you ssh in, use your favorite text editor, and you update that grocery list. There’s no stopping you.</p>
<h1 id="what-s-next-for-our-cli">What’s next for our CLI</h1>
<p>Our CLI has come a long way, we've experimented with various ways of allowing you to quickly find a note and edit it. In the past we experimented with piping output to programs like <code>fzf</code>, we even tried implementing a custom full-screen search. This is the approach that feels the best to us and we think is going to stand the test of time. But work is never done, so here are some of the things we plan to tackle in our CLI:</p>
<ul>
<li>Continue to invest in our release infrastructure to bring our CLI to more package managers. If you'd like to become a maintainer for a particular distro <a href="https://discord.gg/lockbook">reach out!</a>.</li>
<li>Support richer parser inputs including variable number of arguments, grouped command line flags, and logical de-duplication of tab completions (this flag or argument is already specified so don't suggest it again).</li>
<li>Deeper integrations with shells in <code>cli-rs</code>: offer ways to express that this argument is a normal file with completions, or implement mechanisms to re-write the current prompt (<code>lockbook edit sick&lt;tab&gt;</code> tab completes: <code>lockbook edit writing/parth.cafe/creating-a-sick-cli.md</code> presently tab completion options must begin with the current prompt).</li>
<li>A richer showcase of interesting things we can do with our CLI, we plan to set up our blog the way I described above and provide concrete examples of how to do many of the things I outlined. So if you haven't already subscribe to the <a href="https://blog.lockbook.net">Lockbook Blog</a>, and <a href="https://www.youtube.com/@lockbook_net">Lockbook Youtube Channel</a>.</li>
</ul>

        </section>

        
        
        

        
            
            
            

            
        
            
            
            

            
        
            
            
            

            
        
            
            
            

            
        
        

    </article>
</main>


<span id="copy-success" class="hidden">
        Copied!
    </span>
    <span id="copy-init" class="hidden">
        Copy code to clipboard
    </span>
    <script defer src="https://parth.github.io/parth.cafe/js/copyCodeToClipboard.min.js"></script>


    </div>
    <footer>
    <section>
        <nav class="socials nav-navs"><ul><li>
                        <a class="nav-links no-hover-padding social" rel="" 

 href="https://parth.github.io/parth.cafe/atom.xml">
                        <img loading="lazy" alt="feed" title="feed" src="https://parth.github.io/parth.cafe/social_icons/rss.svg">
                        </a>
                    </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding social" rel=" me" 

 href="https://github.com/parth/">
                                    <img loading="lazy" alt="github" title="github" src="https://parth.github.io/parth.cafe/social_icons/github.svg">
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding social" rel=" me" 

 href="https://instagram.com/mehrotraparth">
                                    <img loading="lazy" alt="instagram" title="instagram" src="https://parth.github.io/parth.cafe/social_icons/instagram.svg">
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding social" rel=" me" 

 href="https://www.youtube.com/@ParthMehrotra">
                                    <img loading="lazy" alt="youtube" title="youtube" src="https://parth.github.io/parth.cafe/social_icons/youtube.svg">
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding social" rel=" me" 

 href="https://open.spotify.com/user/1246406255?si=74cbe323cc604663">
                                    <img loading="lazy" alt="spotify" title="spotify" src="https://parth.github.io/parth.cafe/social_icons/spotify.svg">
                                </a>
                            </li>
                        
                    
                </ul>
            
        </nav>

        
        <nav class="nav-navs">
        </nav>

    </section>

    <div id="searchModal" class="search-modal js" role="dialog" aria-labelledby="modalTitle">
    <h1 id="modalTitle" class="visually-hidden">Search</h1>
    <div id="modal-content">
        <div id="searchBar">
            <div class="search-icon" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                    <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
                </svg>
            </div>
            <input id="searchInput" role="combobox" autocomplete="off" spellcheck="false" aria-expanded="false" aria-controls="results-container" placeholder="Search…"/>
            <div id="clear-search" class="close-icon interactive-icon" tabindex="0" role="button" title="Clear search">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/>
                </svg>
            </div>
        </div>
        <div id="results-container">
            <div id="results-info"><span id="zero_results"> No results</span>
                <span id="one_results"> $NUMBER result</span>
                <span id="many_results"> $NUMBER results</span><span id="two_results"> $NUMBER results</span>
                <span id="few_results"> $NUMBER results</span>
            </div>
            <div id="results" role="listbox"></div>
        </div>
    </div>
</div>
</footer>

</body>

</html>
